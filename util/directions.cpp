// Copyright (c) 2022 Richard Kelsey. All rights reserved.

#include "directions.hpp"

#include <Eigen/Core>

extern const std::array<Eigen::Vector3f, 162> directions
{
  Eigen::Vector3f( 0.000000f, -1.000000f, 0.000000f ),
  Eigen::Vector3f( 0.000000f, 1.000000f, 0.000000f ),
  Eigen::Vector3f( -0.023817f, -0.961938f, -0.272227f ),
  Eigen::Vector3f( -0.023817f, 0.961938f, -0.272227f ),
  Eigen::Vector3f( 0.023817f, -0.961938f, 0.272227f ),
  Eigen::Vector3f( 0.023817f, 0.961938f, 0.272227f ),
  Eigen::Vector3f( -0.045820f, -0.850651f, -0.523731f ),
  Eigen::Vector3f( -0.045820f, 0.850651f, -0.523731f ),
  Eigen::Vector3f( 0.045820f, -0.850651f, 0.523731f ),
  Eigen::Vector3f( 0.045820f, 0.850651f, 0.523731f ),
  Eigen::Vector3f( -0.074139f, -0.525731f, -0.847414f ),
  Eigen::Vector3f( -0.074139f, 0.525731f, -0.847414f ),
  Eigen::Vector3f( 0.074139f, -0.525731f, 0.847414f ),
  Eigen::Vector3f( 0.074139f, 0.525731f, 0.847414f ),
  Eigen::Vector3f( -0.078952f, -0.262866f, 0.961597f ),
  Eigen::Vector3f( -0.078952f, 0.262866f, 0.961597f ),
  Eigen::Vector3f( 0.078952f, -0.262866f, -0.961597f ),
  Eigen::Vector3f( 0.078952f, 0.262866f, -0.961597f ),
  Eigen::Vector3f( -0.087156f, 0.000000f, -0.996195f ),
  Eigen::Vector3f( 0.087156f, 0.000000f, 0.996195f ),
  Eigen::Vector3f( -0.099544f, -0.702046f, 0.705140f ),
  Eigen::Vector3f( -0.099544f, 0.702046f, 0.705140f ),
  Eigen::Vector3f( 0.099544f, -0.702046f, -0.705140f ),
  Eigen::Vector3f( 0.099544f, 0.702046f, -0.705140f ),
  Eigen::Vector3f( -0.188388f, 0.000000f, 0.982095f ),
  Eigen::Vector3f( 0.188388f, 0.000000f, -0.982095f ),
  Eigen::Vector3f( -0.220478f, -0.702046f, -0.677141f ),
  Eigen::Vector3f( -0.220478f, 0.702046f, -0.677141f ),
  Eigen::Vector3f( 0.220478f, -0.702046f, 0.677141f ),
  Eigen::Vector3f( 0.220478f, 0.702046f, 0.677141f ),
  Eigen::Vector3f( -0.221087f, -0.862669f, 0.454889f ),
  Eigen::Vector3f( -0.221087f, 0.862669f, 0.454889f ),
  Eigen::Vector3f( 0.221087f, -0.862669f, -0.454889f ),
  Eigen::Vector3f( 0.221087f, 0.862669f, -0.454889f ),
  Eigen::Vector3f( -0.237331f, -0.500000f, 0.832871f ),
  Eigen::Vector3f( -0.237331f, 0.500000f, 0.832871f ),
  Eigen::Vector3f( 0.237331f, -0.500000f, -0.832871f ),
  Eigen::Vector3f( 0.237331f, 0.500000f, -0.832871f ),
  Eigen::Vector3f( -0.244732f, -0.262866f, -0.933278f ),
  Eigen::Vector3f( -0.244732f, 0.262866f, -0.933278f ),
  Eigen::Vector3f( 0.244732f, -0.262866f, 0.933278f ),
  Eigen::Vector3f( 0.244732f, 0.262866f, 0.933278f ),
  Eigen::Vector3f( -0.247706f, -0.951057f, 0.184752f ),
  Eigen::Vector3f( -0.247706f, 0.951057f, 0.184752f ),
  Eigen::Vector3f( 0.247706f, -0.951057f, -0.184752f ),
  Eigen::Vector3f( 0.247706f, 0.951057f, -0.184752f ),
  Eigen::Vector3f( -0.276025f, -0.951057f, -0.138931f ),
  Eigen::Vector3f( -0.276025f, 0.951057f, -0.138931f ),
  Eigen::Vector3f( 0.276025f, -0.951057f, 0.138931f ),
  Eigen::Vector3f( 0.276025f, 0.951057f, 0.138931f ),
  Eigen::Vector3f( -0.296719f, -0.862668f, -0.409586f ),
  Eigen::Vector3f( -0.296719f, 0.862668f, -0.409586f ),
  Eigen::Vector3f( 0.296719f, -0.862668f, 0.409586f ),
  Eigen::Vector3f( 0.296719f, 0.862668f, 0.409586f ),
  Eigen::Vector3f( -0.356065f, 0.000000f, -0.934461f ),
  Eigen::Vector3f( 0.356065f, 0.000000f, 0.934461f ),
  Eigen::Vector3f( -0.357051f, -0.259892f, 0.897202f ),
  Eigen::Vector3f( -0.357051f, 0.259892f, 0.897202f ),
  Eigen::Vector3f( 0.357051f, -0.259892f, -0.897202f ),
  Eigen::Vector3f( 0.357051f, 0.259892f, -0.897202f ),
  Eigen::Vector3f( -0.372478f, -0.688191f, 0.622618f ),
  Eigen::Vector3f( -0.372478f, 0.688191f, 0.622618f ),
  Eigen::Vector3f( 0.372478f, -0.688191f, -0.622618f ),
  Eigen::Vector3f( 0.372478f, 0.688191f, -0.622618f ),
  Eigen::Vector3f( -0.378352f, -0.500000f, -0.779006f ),
  Eigen::Vector3f( -0.378352f, 0.500000f, -0.779006f ),
  Eigen::Vector3f( 0.378352f, -0.500000f, 0.779006f ),
  Eigen::Vector3f( 0.378352f, 0.500000f, 0.779006f ),
  Eigen::Vector3f( -0.449591f, 0.000000f, 0.893234f ),
  Eigen::Vector3f( 0.449591f, 0.000000f, -0.893234f ),
  Eigen::Vector3f( -0.471165f, -0.809017f, 0.351419f ),
  Eigen::Vector3f( -0.471165f, 0.809017f, 0.351419f ),
  Eigen::Vector3f( 0.471165f, -0.809017f, -0.351419f ),
  Eigen::Vector3f( 0.471165f, 0.809017f, -0.351419f ),
  Eigen::Vector3f( -0.474936f, -0.688191f, -0.548479f ),
  Eigen::Vector3f( -0.474936f, 0.688191f, -0.548479f ),
  Eigen::Vector3f( 0.474936f, -0.688191f, 0.548479f ),
  Eigen::Vector3f( 0.474936f, 0.688191f, 0.548479f ),
  Eigen::Vector3f( -0.507424f, -0.259892f, -0.821570f ),
  Eigen::Vector3f( -0.507424f, 0.259892f, -0.821570f ),
  Eigen::Vector3f( 0.507424f, -0.259892f, 0.821570f ),
  Eigen::Vector3f( 0.507424f, 0.259892f, 0.821570f ),
  Eigen::Vector3f( -0.523731f, -0.850651f, 0.045820f ),
  Eigen::Vector3f( -0.523731f, 0.850651f, 0.045820f ),
  Eigen::Vector3f( 0.523731f, -0.850651f, -0.045820f ),
  Eigen::Vector3f( 0.523731f, 0.850651f, -0.045820f ),
  Eigen::Vector3f( -0.525030f, -0.809017f, -0.264263f ),
  Eigen::Vector3f( -0.525030f, 0.809017f, -0.264263f ),
  Eigen::Vector3f( 0.525030f, -0.809017f, 0.264263f ),
  Eigen::Vector3f( 0.525030f, 0.809017f, 0.264263f ),
  Eigen::Vector3f( -0.525569f, -0.425325f, 0.736801f ),
  Eigen::Vector3f( -0.525569f, 0.425325f, 0.736801f ),
  Eigen::Vector3f( 0.525569f, -0.425325f, -0.736801f ),
  Eigen::Vector3f( 0.525569f, 0.425325f, -0.736801f ),
  Eigen::Vector3f( -0.597870f, 0.000000f, -0.801593f ),
  Eigen::Vector3f( 0.597870f, 0.000000f, 0.801593f ),
  Eigen::Vector3f( -0.629953f, -0.160622f, 0.759842f ),
  Eigen::Vector3f( -0.629953f, 0.160622f, 0.759842f ),
  Eigen::Vector3f( 0.629953f, -0.160622f, -0.759842f ),
  Eigen::Vector3f( 0.629953f, 0.160622f, -0.759842f ),
  Eigen::Vector3f( -0.645528f, -0.425325f, -0.634343f ),
  Eigen::Vector3f( -0.645528f, 0.425325f, -0.634343f ),
  Eigen::Vector3f( 0.645528f, -0.425325f, 0.634343f ),
  Eigen::Vector3f( 0.645528f, 0.425325f, 0.634343f ),
  Eigen::Vector3f( -0.648503f, -0.587785f, 0.483687f ),
  Eigen::Vector3f( -0.648503f, 0.587785f, 0.483687f ),
  Eigen::Vector3f( 0.648503f, -0.587785f, -0.483687f ),
  Eigen::Vector3f( 0.648503f, 0.587785f, -0.483687f ),
  Eigen::Vector3f( -0.685376f, -0.693780f, 0.221198f ),
  Eigen::Vector3f( -0.685376f, 0.693780f, 0.221198f ),
  Eigen::Vector3f( 0.685376f, -0.693780f, -0.221198f ),
  Eigen::Vector3f( 0.685376f, 0.693780f, -0.221198f ),
  Eigen::Vector3f( -0.713374f, -0.693780f, -0.098823f ),
  Eigen::Vector3f( -0.713374f, 0.693780f, -0.098823f ),
  Eigen::Vector3f( 0.713374f, -0.693780f, 0.098823f ),
  Eigen::Vector3f( 0.713374f, 0.693780f, 0.098823f ),
  Eigen::Vector3f( -0.722642f, -0.587785f, -0.363727f ),
  Eigen::Vector3f( -0.722642f, 0.587785f, -0.363727f ),
  Eigen::Vector3f( 0.722642f, -0.587785f, 0.363727f ),
  Eigen::Vector3f( 0.722642f, 0.587785f, 0.363727f ),
  Eigen::Vector3f( -0.752328f, -0.160622f, -0.638908f ),
  Eigen::Vector3f( -0.752328f, 0.160622f, -0.638908f ),
  Eigen::Vector3f( 0.752328f, -0.160622f, 0.638908f ),
  Eigen::Vector3f( 0.752328f, 0.160622f, 0.638908f ),
  Eigen::Vector3f( -0.762361f, -0.309017f, 0.568608f ),
  Eigen::Vector3f( -0.762361f, 0.309017f, 0.568608f ),
  Eigen::Vector3f( 0.762361f, -0.309017f, -0.568608f ),
  Eigen::Vector3f( 0.762361f, 0.309017f, -0.568608f ),
  Eigen::Vector3f( -0.801593f, 0.000000f, 0.597870f ),
  Eigen::Vector3f( 0.801593f, 0.000000f, -0.597870f ),
  Eigen::Vector3f( -0.836735f, -0.433889f, 0.334089f ),
  Eigen::Vector3f( -0.836735f, 0.433889f, 0.334089f ),
  Eigen::Vector3f( 0.836735f, -0.433889f, -0.334089f ),
  Eigen::Vector3f( 0.836735f, 0.433889f, -0.334089f ),
  Eigen::Vector3f( -0.847414f, -0.525731f, 0.074139f ),
  Eigen::Vector3f( -0.847414f, 0.525731f, 0.074139f ),
  Eigen::Vector3f( 0.847414f, -0.525731f, -0.074139f ),
  Eigen::Vector3f( 0.847414f, 0.525731f, -0.074139f ),
  Eigen::Vector3f( -0.849516f, -0.309017f, -0.427587f ),
  Eigen::Vector3f( -0.849516f, 0.309017f, -0.427587f ),
  Eigen::Vector3f( 0.849516f, -0.309017f, 0.427587f ),
  Eigen::Vector3f( 0.849516f, 0.309017f, 0.427587f ),
  Eigen::Vector3f( -0.882037f, -0.433889f, -0.183716f ),
  Eigen::Vector3f( -0.882037f, 0.433889f, -0.183716f ),
  Eigen::Vector3f( 0.882037f, -0.433889f, 0.183716f ),
  Eigen::Vector3f( 0.882037f, 0.433889f, 0.183716f ),
  Eigen::Vector3f( -0.893234f, 0.000000f, -0.449591f ),
  Eigen::Vector3f( 0.893234f, 0.000000f, 0.449591f ),
  Eigen::Vector3f( -0.924527f, -0.162460f, 0.344755f ),
  Eigen::Vector3f( -0.924527f, 0.162460f, 0.344755f ),
  Eigen::Vector3f( 0.924527f, -0.162460f, -0.344755f ),
  Eigen::Vector3f( 0.924527f, 0.162460f, -0.344755f ),
  Eigen::Vector3f( -0.958278f, -0.273266f, 0.083838f ),
  Eigen::Vector3f( -0.958278f, 0.273266f, 0.083838f ),
  Eigen::Vector3f( 0.958278f, -0.273266f, -0.083838f ),
  Eigen::Vector3f( 0.958278f, 0.273266f, -0.083838f ),
  Eigen::Vector3f( -0.970348f, -0.162460f, -0.178975f ),
  Eigen::Vector3f( -0.970348f, 0.162460f, -0.178975f ),
  Eigen::Vector3f( 0.970348f, -0.162460f, 0.178975f ),
  Eigen::Vector3f( 0.970348f, 0.162460f, 0.178975f ),
  Eigen::Vector3f( -0.996195f, 0.000000f, 0.087156f ),
  Eigen::Vector3f( 0.996195f, 0.000000f, -0.087156f )
};

extern bool debugPrint;

uint16_t closestDirection(const Eigen::Vector3f& vector)
{
    uint32_t best = 0;
    float bestDot = 0.0f;

    for (uint32_t i = 0; i < directions.size(); i++) {
        float dot = vector.dot(directions[i]);
        if (bestDot < dot) {
            best = i;
            bestDot = dot;
        }
    }
    return best;
}
